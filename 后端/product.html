<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<script src="./js/vue.js"></script>
		<script src="./js/axios.js"></script>
		
		<style>
			table{
				border: 1px solid lightblue;
				width: 100%;
			}
			
			table td{
				text-align: center;
			}
			
			thead td{
				border: 1px solid red;
				font-weight: 700;
				
			}
			tbody td{
				border: 1px solid green;
			}
		</style>
	</head>
	<body>
		
		<div id="app">
			<button @click="add">商品上架</button>
			<button @click="search">查询</button>
			
			            
			
			<table>
				<thead>
					<tr>
						<td>商品ID</td>
						<td>商品名字</td>
						<td>商品价钱</td>
						<td>商品描述</td>
						<td>商品图片</td>
						<td>操作</td>
					</tr>
				</thead>
				<tbody>
					
					<tr v-for="(product,index) of productList" :key="product.pid">
						<td>{{product.pid}}</td>
						<td>{{product.pname}}</td>
						<td>{{product.price}}</td>
						<td>{{product.description}}</td>
						<td>{{product.picture}}</td>
						
						<td>
							<button @click="change(product)">修改</button>
							<button @click="remove(product.pid,index)">删除</button>
						</td>				
					</tr>
					
					
				</tbody>
				
				
			</table>			
		</div>
		
		
		<script>
			
			//设置axios使用ajax的时候允许携带cookie
			axios.defaults.withCredentials = true;
			
			let v = new Vue({
				
				data:{
					productList: [],
					searchText: '',
				},
				methods:{
					add(){
						location.href = './product_add.html';
					},
					change(product){
						  let pid = product.pid;
						  let pname = prompt('请输入新的商品名字', product.pname);
						  let price = prompt('请输入新的商品价格', product.price);
						  let description = prompt('请输入新的商品描述', product.description);
						  let picture = prompt('请输入新的商品图片', product.picture);
						
						  axios.post('http://127.0.0.1:8080/project/UpdateProductServlet', { 
						    pid,
						    pname,
						    price,
						    description,
						    picture
						  }).then(r => {
						    if (r.data.isOK) {
						      alert('修改成功');
						      product.pname = pname;
						      product.price = price;
						      product.description = description;
						      product.picture = picture;
							 
						    } else {
								
						      alert('修改失败');
						    }
						  })
					},
					remove(pid,index){
						if(confirm('确定要删除吗?')){
							axios.get('http://127.0.0.1:8080/project/RemoveServlet',{params: {
                                                                 pid, }}).then(r=>{
								if(r.data.isOK){
									alert(('删除成功'))
									this.productList.splice(index,1);
									
								}else{
									alert('删除失败')
								}
							})
						}
						
					},
					search(){
					          
							
								location.href='./search.html';           
					                    },
					                
				},
				
								
				created(){
					axios.get('http://127.0.0.1:8080/project/GetAllProduct').then(r=>{
						this.productList = r.data.list;
					})
				},
				
			}).$mount('#app')
			
			
		</script>
		
		
	</body>
</html>